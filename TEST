import win32com.client
import pytest

@pytest.mark.order(-1)
@pytest.mark.parametrize("testcase", get_testdata("test_fah_concurrent"))
def test_FAH_Concurrent(get_testcasejson, testcase):
    json_data = get_testcasejson

    # Extract required values from the JSON data
    # Assuming there are keys like 'path' and 'results_location' in your JSON
    test_path = json_data.get("path", "")  # Replace "path" with the actual key name
    results_location = json_data.get("results_location", "")  # Replace "results_location" with the actual key name

    try:
        qtp = win32com.client.Dispatch("QuickTest.Application")
        qtp.Launch() 
        qtp.Visible = True
        qtp.Open(test_path)  # Pass the test path obtained from JSON
        qtResultsOpt = win32com.client.Dispatch("QuickTest.RunResultsOptions")
        qtResultsOpt.ResultsLocation = results_location  # Pass the results location obtained from JSON
        qtp.Test.Run(qtResultsOpt)
        qtp.Test.Close()
        qtp.Quit()
        print("Test execution successful!")

    except AssertionError:
        raise Exception("Test execution failed.")
