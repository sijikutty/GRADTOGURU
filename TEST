import os
import time
import openpyxl
from playwright.sync_api import sync_playwright

# Function to download the Excel file
def download_excel_file(page):
    page.click("a[href$='.xlsx']")

# Function to verify the cell value in the downloaded Excel file
def verify_cell_value(file_path):
    try:
        workbook = openpyxl.load_workbook(filename=file_path)
        worksheet = workbook.active
        cell_value = worksheet.cell(row=1, column=2).value
        return cell_value == 4
    except Exception as e:
        print("Error occurred while verifying cell value:", e)
        return False

with sync_playwright() as p:
    browser = p.chromium.launch()
    page = browser.new_page()
    
    page.goto("https://example.com")  # Replace with the URL of your website
    
    # Click on the link to download the Excel file
    download_excel_file(page)
    
    # Wait for the download to complete (you may need to adjust the timeout)
    time.sleep(5)
    
    # Get the latest downloaded Excel file
    download_folder = os.path.join(os.path.expanduser("~"), "Downloads")
    files = os.listdir(download_folder)
    excel_files = [f for f in files if f.endswith('.xlsx')]
    if excel_files:
        latest_file = max(excel_files, key=lambda x: os.path.getctime(os.path.join(download_folder, x)))
        file_path = os.path.join(download_folder, latest_file)
        print("Latest downloaded file:", file_path)
        
        # Verify the cell value in the downloaded Excel file
        cell_value_correct = verify_cell_value(file_path)
        if cell_value_correct:
            print("Cell value in column 2, row 1 is 4.")
        else:
            print("Cell value in column 2, row 1 is not 4.")
    else:
        print("No Excel file found in the download folder.")
    
    browser.close()
