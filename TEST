from playwright.sync_api import Page
from automation_utils import get_testdata
from ps_utils import navigate_menu
import pytest 
import time
from Common_function import jrnl_post

@pytest.mark.parametrize("testcase", get_testdata("test_manual_jrnl_post"))
def test_manual_jrnl_post(page: Page, testcase):
    # Extract test data for the current test case
    testdata = testcase["testdata"]
    
    # Navigate to the User Preferences page
    navigate_menu(page=page,
                  menu_sequence=["Set Up Financials/Supply Chain", 
                                 "Common Definitions", 
                                 "User Preferences", 
                                 "Define User Preferences"])

    # Access the target iframe containing the form
    targetContentFrame = page.frame_locator("iframe[name=\"TargetContent\"]")

    # Fill in the User ID
    targetContentFrame.get_by_label("User ID").fill(testdata['userid'])

    # Click the Search link to find the user
    targetContentFrame.get_by_role("cell", name="Search", exact=True).locator("a").click()

    # Navigate to the General Ledger section
    targetContentFrame.get_by_role("link", name="General Ledger").click()

    # Enable the Online Journal Posting option
    targetContentFrame.get_by_label("Enable Online Journal Post").check()

    # Save the changes made
    targetContentFrame.get_by_role("button", name="Save").click()

    # Call the function to post the journal using the provided test data
    jrnl_post(page, testdata)
