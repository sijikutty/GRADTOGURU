import paramiko

# SSH connection details
hostname = "n"
username = "p"
password = "m"  # Replace with your actual password
directory_to_enter = 'k'  # The directory you want to enter
search_path = '/fit/data/in'  # Replace with the path to search, e.g., '/home/user'
search_path = '/appl/cits/dev/infashr/fit/data/in'
target_substring = 'maxi'  # Substring to search for in file names

def list_folders(sftp, remote_path, indentation=""):
    try:
        # Change directory to the remote_path
        sftp.chdir(remote_path)

        # List all items (files and directories) in the current directory
        items = sftp.listdir()

        for item in items:
            # Check if the item is a directory
            try:
                # Attempt to change into the directory to verify it's a folder
                sftp.chdir(f"{remote_path}/{item}")
                print(f"{indentation}{item}/")  # Print folder name with indentation

                # Recursively list subfolders
                list_folders(sftp, f"{remote_path}/{item}", indentation + "    ")

                # Change back to the parent directory after listing subfolders
                sftp.chdir(remote_path)

            except IOError:
                # IOError will be raised if it's not a directory or if permission is denied
                pass

    except IOError:
        # IOError will be raised if directory doesn't exist or permission is denied
        pass

    except Exception as e:
        print(f"Error listing folder {remote_path}: {str(e)}")



# Create an SSH client instance
ssh_client = paramiko.SSHClient()
ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

try:
    # Connect to the SSH server using password authentication
    ssh_client.connect(hostname=hostname, username=username, password=password)

    # Open an SFTP session on the SSH connection
    sftp = ssh_client.open_sftp()

    # Print all folders and subfolders starting from root directory ("/")
    print(f"Listing all folders and subfolders in {hostname}:")
    list_folders(sftp, "/")

finally:
    # Close the SFTP session and SSH connection
    if ssh_client:
        ssh_client.close()
