import paramiko

# SSH connection details
hostname = 'example.com'
username = 'your_username'
password = 'your_password'
target_substring = 'maxi'  # Substring to search for in file names

# Function to recursively search for a file containing a substring
def search_for_file(sftp, current_directory, target_substring):
    try:
        # Change directory to the current directory
        sftp.chdir(current_directory)

        # List all items (files and directories) in the current directory
        items = sftp.listdir()

        for item in items:
            # Check if the item is a file and contains the target substring
            if target_substring in item and sftp.stat(item).st_mode // 32768 == 1:  # File check
                return True
            # Check if the item is a directory
            elif sftp.stat(item).st_mode // 32768 == 1:  # Directory check
                # Recursively search within this directory
                if search_for_file(sftp, f"{current_directory}/{item}", target_substring):
                    return True

        return False

    except FileNotFoundError:
        return False

    except Exception as e:
        print(f"Error searching for file in {current_directory}: {str(e)}")
        return False

# Create an SSH client instance
ssh_client = paramiko.SSHClient()
ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

try:
    # Connect to the SSH server using password authentication
    ssh_client.connect(hostname=hostname, username=username, password=password)

    # Open an SFTP session on the SSH connection
    sftp = ssh_client.open_sftp()

    # Check if any file with the target substring exists anywhere
    if search_for_file(sftp, "/", target_substring):
        print(f"A file containing '{target_substring}' in its name exists in at least one directory on the server.")
    else:
        print(f"No file containing '{target_substring}' in its name exists in any directory on the server.")

finally:
    # Close the SFTP session and SSH connection
    if ssh_client:
        ssh_client.close()
