import boto3
from botocore.exceptions import ClientError
import json
import oracledb

def get_DBsecrets(secretID):
    try:
        # Initialize boto3 client with region
        secretmanagerclient = boto3.client("secretsmanager", region_name="us-east-1")

        response = secretmanagerclient.get_secret_value(SecretId=secretID)
        secret = json.loads(response['SecretString'])

        db_secrets = {
            'username': secret['username'],
            'password': secret['password'],
            'host': secret['host'],
            'port': secret['port'],
            'servicename': secret['dbname'],
        }

        return db_secrets

    except ClientError as e:
        print(f"Error retrieving secret: {e}")
        return None

def connect_to_oracleDB(secretID):
    db_secrets = get_DBsecrets(secretID)

    try:
        print("Connecting to DB")
        connection = oracledb.connect(user=db_secrets['username'],
                                      password=db_secrets['password'],
                                      host=db_secrets['host'],
                                      port=db_secrets['port'],
                                      service_name=db_secrets['servicename'])

        print(f"Database connected successfully", connection)
        return {"status": True, "conn": connection}

    except oracledb.Error as e:
        print(f"ORACLE Error: ", str(e))
        return {"status": False, "error": str(e)}

if __name__ == "__main__":
    # Example usage with a specific secret ID
    result = connect_to_oracleDB("your_secret_id")
    print(result)
