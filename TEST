import os
import json
import boto3

# Assume get_secrets function is already defined elsewhere

def get_secrets(secretID):
    # Function to retrieve secrets from AWS Secrets Manager
    session = boto3.Session(profile_name="dev")
    secretmanagerclient = session.client("secretsmanager", region_name="us-east-1")
    response = secretmanagerclient.get_secret_value(SecretId=secretID)
    secret = json.loads(response['SecretString'])
    return secret

def construct_credentials(testdata):
    # Function to construct credentials data structure
    fahsecrets = get_secrets(testdata["fahsecretID"])

    data = {
        "fahuser": [
            {
                "fahusername": fahsecrets['User'],
                "fahpassword": fahsecrets['Password']
            }
        ]
    }

    return data

def save_credentials(testdata):
    # Test path retrieval
    test_path = testdata["test_path"]

    # Construct credentials data
    data = construct_credentials(testdata)

    # Directory where JSON file will be located
    directory = os.path.expanduser('~')  # Example: current user's home directory

    # Ensure the directory exists, create if not
    os.makedirs(os.path.join(directory, '.secret'), exist_ok=True)

    # Path to the JSON file
    cred_json_file_path = os.path.join(directory, '.secret', 'credentials.json')

    # Save data to JSON file
    with open(cred_json_file_path, 'w') as f:
        json.dump(data, f, indent=4)

    print(f"Credentials saved to {cred_json_file_path}")

# Example usage:
testdata = {
    "fahsecretID": "your_fah_secret_id_from_secrets_manager",
    "test_path": "/path/to/test",
    # Add other required fields as per your script's needs
}

save_credentials(testdata)
