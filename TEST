from automation_utils import get_testdata
import pytest
import subprocess

@pytest.mark.parametrize("testcase", get_testdata("test_fah_concurrent"))
def test_FAH_Concurrent(testcase):

    testdata = testcase["testdata"]
    test_path = testdata["test_path"]
    fah_url = testdata["fah_url"]
    
    print("Running UFT test:", test_path)
    
    try:
        # Construct the command to run the UFT test using UFT executable
        command = [r"C:\Program Files (x86)\Micro Focus\UFT One\bin\UFT.exe", "/Test", test_path]

        # Execute the command
        result = subprocess.run(command, capture_output=True, text=True)

        # Print stdout and stderr
        print("Standard Output:")
        print(result.stdout)
        
        print("Standard Error:")
        print(result.stderr)
        
        # Check return code
        if result.returncode != 0:
            raise Exception("UFT Test Failed.")
        
    except Exception as e:
        print("Error executing UFT test:", e)
        raise
