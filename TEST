import paramiko

def write_file_content(sftp, remote_file_path, content):
    try:
        # Open the file in write mode to replace content
        with sftp.open(remote_file_path, 'w') as file:
            file.write(content)
        
        print(f"Modification completed: Successfully updated file {remote_file_path}")

    except Exception as e:
        print(f"Modification failed: Error updating file {remote_file_path}: {str(e)}")

def directory_exists(sftp, remote_path):
    try:
        sftp.stat(remote_path)
        return True
    except FileNotFoundError:
        return False
    except Exception as e:
        print(f"Error checking directory existence: {str(e)}")
        return False

def update_remote_file(hostname, username, password, search_path, file_to_edit, new_content):
    ssh_client = paramiko.SSHClient()
    ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    
    try:
        ssh_client.connect(hostname=hostname, username=username, password=password)
        sftp = ssh_client.open_sftp()
    
        if directory_exists(sftp, search_path):
            print("Directory exists")
            
            file_path = f"{search_path}/{file_to_edit}"
            write_file_content(sftp, file_path, new_content)
            
        else:
            print(f"Directory {search_path} does not exist on the server.")
    
    except Exception as e:
        print(f"Failed to update file: {str(e)}")
    
    finally:
        if ssh_client:
            ssh_client.close()

---------
import pytest
from playwright.sync_api import Page
from automation_utils import get_testdata, get_secrets
from update_utils import update_remote_file  # Assuming the refactored function is in update_utils

@pytest.mark.parametrize("testcase", get_testdata("test_Maximis_regression"))
def test_Maximis_regression(page: Page, testcase):
    testdata = testcase["testdata"]
    secrets = get_secrets(testdata["ods_unix_secretID"])

    hostname = testdata["hostname"]
    username = secrets['User']
    password = secrets['Password']

    search_path = testdata["search_path"]
    file_to_edit = testdata["file_to_edit"]
    new_content = testdata["new_content"]

    update_remote_file(hostname, username, password, search_path, file_to_edit, new_content)
