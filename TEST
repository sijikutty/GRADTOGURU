Function WriteRallyJson(TCName, TCID, verdict, result)
    ' Import data from Excel sheet
    Datatable.Importsheet "C:\Github\corp_corpit_ps_egl_test_automation\UFT\PS_FAH_Input.xlsx","COMMON","Global"
    
    ' Get current date and time
    current_datetime = Now
    
    ' Format the date and time
    formatted_datetime = Year(current_datetime) & "-" & Right("0" & Month(current_datetime), 2) & "-" & Right("0" & Day(current_datetime), 2) & "T" & Right("0" & Hour(current_datetime), 2) & ":" & Right("0" & Minute(current_datetime), 2) & ":" & Right("0" & Second(current_datetime), 2)
    
    ' Get microseconds part
    microseconds = Right(FormatNumber((current_datetime - Int(current_datetime)) * 1000000, 6), 6)
    
    ' Concatenate microseconds to the formatted string
    formatted_datetime_with_microseconds = formatted_datetime & "." & microseconds
    
    ' Retrieve values from Excel sheet
    server = Datatable.Value("server")
    user = Datatable.Value("user")
    apikey = Datatable.Value("apikey")
    workspace = Datatable.Value("workspace")
    project = Datatable.Value("project")
    envr = Datatable.Value("envr")
    s3bucket = Datatable.Value("s3bucket")
    s3filename = Datatable.Value("outputfile")

    ' Create JSON content
    Dim jsonContent, rallyContent
    Set jsonContent = CreateObject("Scripting.Dictionary")
    jsonContent.Add "key", TCName
    
    Set rallyContent = CreateObject("Scripting.Dictionary")
    rallyContent.Add "server", server
    rallyContent.Add "user", user
    rallyContent.Add "apikey", apikey
    rallyContent.Add "workspace", workspace
    rallyContent.Add "project", project
    rallyContent.Add "Tcid", TCID
    rallyContent.Add "build", (envr & "-Automated Run")
    rallyContent.Add "run_date", formatted_datetime_with_microseconds
    rallyContent.Add "verdict", verdict
    rallyContent.Add "notes", result

    ' Create JSON string
    Dim jsonData
    jsonData = "{"
    jsonData = jsonData & """key"":""" & jsonContent("key") & ""","
    jsonData = jsonData & """Rally"":{"
    For Each key In rallyContent.Keys
        jsonData = jsonData & """" & key & """:""" & rallyContent(key) & ""","
    Next
    jsonData = Left(jsonData, Len(jsonData) - 1) ' Remove the trailing comma
    jsonData = jsonData & "}}"

    ' Retrieve Python executable and script paths from Excel sheet
    Dim pythonExePath, scriptpath
    pythonExePath = """" & Datatable.Value("pythonexe") & """"
    scriptpath = Datatable.Value("upldtos3pypath")
	
    ' Set file path for JSON data
    Dim filePath
    filePath = Datatable.Value("rallyjson")
    
    ' Create FileSystemObject
    Dim fs, outFile
    Set fs = CreateObject("Scripting.FileSystemObject")
    
    ' Create or overwrite the file
    Set outFile = fs.CreateTextFile(filePath, True)
    
    ' Write JSON content to the file
    outFile.WriteLine(jsonData)
    
    ' Close the file
    outFile.Close
    
    ' Run the Python script
    Dim execString, WshShell, oExec
    execString = pythonExePath & " """ & scriptpath & """ """ & filePath & """ """ & s3bucket & """ """ & s3filename & """"
    
    ' Create WshShell object
    Set WshShell = CreateObject("WScript.Shell")
    
    ' Execute the command using SystemUtil.Run
    Set oExec = WshShell.Exec(execString)
End Function  
