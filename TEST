from playwright.sync_api import sync_playwright

def run(playwright):
    browser = playwright.chromium.launch(headless=False)
    page = browser.new_page()

    # Step 1: Navigate to the main page
    page.goto("https://example.com")

    # Step 2: Click the 'Copy to File' button directly
    try:
        copy_button = page.get_by_role("button", name="Copy to File")
        assert copy_button.is_visible(), "Copy to File button is not visible."
        print("Copy to File button is visible. Clicking...")
        
        # Click the button and expect the first popup
        first_popup = page.expect_popup(lambda: copy_button.click())
        print("First popup opened.")
    except Exception as e:
        print(f"Error clicking 'Copy to File' button: {e}")
        browser.close()
        return

    # Step 3: In the first popup, wait for and click the 'Run' button
    try:
        run_button = first_popup.value.get_by_role("button", name="Run")
        run_button.wait_for(state="visible")
        run_button.click()
        print("Run button clicked.")
    except Exception as e:
        print(f"Error interacting with first popup: {e}")
        browser.close()
        return

    # Step 4: In the second popup, wait for and click the 'OK' button
    try:
        second_popup = first_popup.value.expect_popup(lambda: run_button.click())
        print("Second popup opened.")

        ok_button = second_popup.value.get_by_role("button", name="OK")
        ok_button.wait_for(state="visible")
        ok_button.click()
        print("OK button clicked.")
    except Exception as e:
        print(f"Error interacting with second popup: {e}")
    finally:
        # Clean up: Close the popups if necessary
        first_popup.value.close()
        second_popup.value.close()
        browser.close()

with sync_playwright() as playwright:
    run(playwright)
