from playwright.sync_api import Page
from automation_utils import get_testdata
from ps_utils import navigate_menu,add_run_control_id,schedule_process, monitor_process
import pytest 
import time
from Common_function import jrnl_create

@pytest.mark.parametrize("testcase", get_testdata("test_batch_jrnl_edit"))
def test_batch_jrnl_edit(page:Page,  testcase):

    testdata = testcase["testdata"]
    journal_id=jrnl_create(page,  testdata)

    navigate_menu(page=page,
                  menu_sequence=["General Ledger", 
                                 "Journals", 
                                 "Process Journals", 
                                 "Edit Journals"])
    
    # Fill values in the page
    add_run_control_id(page=page, run_ctrl_id=testdata['run_control_id'])
    targetContentFrame = page.frame_locator("iframe[name=\"TargetContent\"]")
  
    targetContentFrame.get_by_label("Once").check()
    targetContentFrame.get_by_label("Business Unit").fill(testdata['business_unit'])
    
    targetContentFrame.get_by_label("Journal ID From").fill(journal_id)
    targetContentFrame.get_by_label("To Journal ID").fill(journal_id)
    targetContentFrame.get_by_label("Description").fill(testdata['run_control_id'])
    targetContentFrame.get_by_role("button", name="Run").click()

    process_instance_id = schedule_process(page=page, server_name=testdata["server"],process_name=testdata["editprocess"])

    run_status = monitor_process(page=page, process_inst_id=process_instance_id, server=testdata["server"])

    print(f"Journal Batch Edit Program Run status : ", run_status)
