Function WriteRallyJson(TCName,TCID,verdict,result)
	Dim fs, outFile, jsonContent, jsonData
	'Time format
	' Get the current date and time
	current_datetime = Now
	
	' Format the date and time to a string
	formatted_datetime = Year(current_datetime) & "-" & Right("0" & Month(current_datetime), 2) & "-" & Right("0" & Day(current_datetime), 2) & "T" & Right("0" & Hour(current_datetime), 2) & ":" & Right("0" & Minute(current_datetime), 2) & ":" & Right("0" & Second(current_datetime), 2)
	
	' Get the microseconds part
	microseconds = Right(FormatNumber((current_datetime - Int(current_datetime)) * 1000000, 6), 6)
	
	' Concatenate microseconds to the formatted string
	formatted_datetime_with_microseconds = formatted_datetime & "." & microseconds
	' Create an instance of the Environment object

	Dim env
	Set env = CreateObject("WScript.Shell").Environment("Process")
	' Retrieve the user's profile directory (home directory)
	Dim homeDir
	homeDir = env("USERPROFILE")
	Set Dom = jsonutil.Parse(homeDir & "\.secret\credentials.json")
	Set rally = Dom.GetArray("rally")
	For Each object in rally
	    server = object.getValue("server")
	    user = object.getValue("user")
	    apikey = object.getValue("apikey")
	    workspace = object.getValue("workspace")
	    project = object.getValue("project")
	    envr = object.getValue("envr")
		s3bucket= object.getValue("s3bucket")
		s3filename= object.getValue("outputfile")
	    Exit For
	Next

	Set jsonContent = CreateObject("Scripting.Dictionary")
	jsonContent.Add "key",TCName
	Set rallyContent = CreateObject("Scripting.Dictionary")
	rallyContent.Add "server", server
	rallyContent.Add "user", user
	rallyContent.Add "apikey", apikey
	rallyContent.Add "workspace", workspace
	rallyContent.Add "project", project
	rallyContent.Add "Tcid", TCID
	rallyContent.Add "build",(envr & "-Automated Run")
	rallyContent.Add "run_date", formatted_datetime_with_microseconds
	rallyContent.Add "verdict", verdict
	rallyContent.Add "notes", result
		
	' Properly escape double quotes in JSON data
	'jsonData = Replace(jsonData, """", "\""")
	

	jsonData = "{"
	'jsonData = ""{""
	jsonData = jsonData & """key"":""" & jsonContent("key") & ""","
	jsonData = jsonData & """Rally"":{"
	'jsonData = jsonData & """Rally"":"""{""
	For Each key In rallyContent.Keys
	    jsonData = jsonData & """" & key & """:""" & rallyContent(key) & ""","
	Next
	jsonData = Left(jsonData, Len(jsonData) - 1) ' Remove the trailing comma
	jsonData = jsonData & "}}"
	'jsonData = jsonData & ""}}""
	
	'SystemUtil.Run "python", "C:\Github\corp_corpit_ps_egl_test_automation\smoketest\test_gui\uploadtos3.py" & jsonData & " " & s3bucket & " " & s3filename, "", output
	'Msgbox output
	'jsonData=""""&jsonData&""""
	'jsonData= Replace(jsonData, """", "\" & """")
	
	
	'Msgbox jsonData
	Dim pythonExePath
	pythonExePath = "C:\Program Files\Python311\python.exe"  ' Specify the full path to the Python executable
	scriptpath="C:\Github\corp_corpit_ps_egl_test_automation\smoketest\test_gui\uploadtos3.py"
	'SystemUtil.Run pythonExePath, "C:\Github\corp_corpit_ps_egl_test_automation\smoketest\test_gui\uploadtos3.py" & jsonData & " " & s3bucket & " " & s3filename, "", output
	 ' SystemUtil.Run pythonExePath, scriptpath & jsonData & " " & s3bucket & " " & s3filename, "", output
	 

	' Dim command
	   ' command = pythonExePath & """ """ & scriptPath & """ """ & jsonData & """ """ & s3bucket & """ """ & s3filename & """"
	    
	    ' Execute the command using SystemUtil.Run
	   ' Dim output
	    'Dim success
	    'success = SystemUtil.Run(command, True, 1, output)
	    
	    ' Check if the Python script executed successfully
	    'If success Then
	        'MsgBox "Python script executed successfully."
	    'Else
	        'MsgBox "Failed to execute Python script."
	    'End If

    
    

	
	' Specify the file path
	filePath = "C:\Github\corp_corpit_ps_egl_test_automation\UFT\rallydata.json"
	
	' Create FileSystemObject
	Set fs = CreateObject("Scripting.FileSystemObject")
	
	' Create or overwrite the file
	Set outFile = fs.CreateTextFile(filePath, True)
	
	' Write JSON content to the file
	outFile.WriteLine(jsonData)
	
	' Close the file
	outFile.Close
	
	' Release objects
	Set outFile = Nothing
	Set fs = Nothing
	Dim json_file_path, bucket_name, s3_file_name, python_script_path,WshShell
	json_file_path = filePath  ' Set the JSON file path
	bucket_name = s3bucket                   ' Set the S3 bucket name
	s3_file_name = s3filename             ' Set the S3 filename
	python_exe_path = """C:\Program Files\Python311\python.exe"""  ' Set the path to your Python script
	python_script_path="C:\Github\corp_corpit_ps_egl_test_automation\smoketest\test_gui\uploadtos3.py"
	execString = python_exe_path & " " & """" & python_script_path & """" & " " & """" & json_file_path & """" & " " & """" & bucket_name & """" & " " & """" & s3_file_name & """"
	Msgbox execString
	' Run the Python script
	Set WshShell = CreateObject("WScript.Shell")
	Set oExec = WshShell.Exec(execString)

' Capture output and error


' Check return code and display messages

	'WScript.Echo "Data written to JSON file successfully."
End Function
