import os
import time
import win32com.client
import pyautogui

def open_excel_file(file_path):
    excel = win32com.client.Dispatch("Excel.Application")
    workbook = excel.Workbooks.Open(file_path)
    return excel, workbook

def check_drill_down_functionality(excel, workbook):
    # Wait for Excel to fully open
    time.sleep(5)
    # Activate Excel window
    excel.Visible = True
    # Simulate clicking on a cell to activate Excel
    pyautogui.click(100, 100)  # Adjust coordinates as needed
    # Here you would write the logic to check for drill-down functionality
    # For example, you might search for specific UI elements or use keyboard shortcuts
    # In this example, we'll just print a message
    print("Drill-down functionality may be available (based on your specific criteria).")
    # Close Excel
    workbook.Close(SaveChanges=False)
    excel.Quit()

# Replace 'YOUR_DOWNLOAD_PATH' with the actual download path
download_path = 'YOUR_DOWNLOAD_PATH'

# Get the latest downloaded Excel file
files = os.listdir(download_path)
excel_files = [f for f in files if f.endswith('.xlsx')]
if excel_files:
    latest_file = sorted(excel_files, key=lambda x: os.path.getctime(os.path.join(download_path, x)), reverse=True)[0]
    file_path = os.path.join(download_path, latest_file)
    print("Latest downloaded file:", file_path)

    # Open the Excel file
    excel, workbook = open_excel_file(file_path)

    # Check drill-down functionality
    check_drill_down_functionality(excel, workbook)
else:
    print("No Excel file found in the download folder.")
