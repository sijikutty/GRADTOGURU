' Import required libraries
Imports System
Imports System.IO
Imports Newtonsoft.Json
Imports Amazon
Imports Amazon.S3
Imports Amazon.S3.Transfer

' Define function to upload file to S3
Function UploadFileToS3(payload, bucketName, s3Filename)
    Try
        ' Serialize payload to JSON and write to a temporary file
        Dim tempFile As String = "Result\rallyTCresults.json"
        File.WriteAllText(tempFile, JsonConvert.SerializeObject(payload))

        ' Create an Amazon S3 client
        Dim region As RegionEndpoint = RegionEndpoint.USEast1 ' Specify your region
        Dim client As AmazonS3Client = New AmazonS3Client(region)

        ' Upload the file to S3
        Dim request As TransferUtilityUploadRequest = New TransferUtilityUploadRequest()
        request.BucketName = bucketName
        request.FilePath = tempFile
        request.Key = s3Filename
        Dim utility As TransferUtility = New TransferUtility(client)
        utility.Upload(request)

        ' Clean up temporary file
        File.Delete(tempFile)

        ' Return success
        Return True

    Catch ex As Exception
        ' Handle exceptions
        Console.WriteLine("Error: " & ex.Message)
        Return False
    End Try
End Function

' Main script
Sub Main()
    ' Define JSON payload, S3 bucket, and S3 filename
    Dim jsonPayload As Object ' Define your JSON payload here
    Dim s3Bucket As String = "your-s3-bucket-name"
    Dim s3Filename As String = "path/to/rallyTCresults.json"

    ' Call function to upload file to S3
    Dim uploadResult As Boolean = UploadFileToS3(jsonPayload, s3Bucket, s3Filename)

    ' Print upload result
    If uploadResult Then
        Console.WriteLine("File uploaded successfully.")
    Else
        Console.WriteLine("Failed to upload file.")
    End If
End Sub

' Call the main script
Main()
